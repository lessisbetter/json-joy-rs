# Compatibility fixtures

Upstream Credit: This fixture corpus verifies behavior against upstream
`json-joy` by streamich.
- Upstream repository: <https://github.com/streamich/json-joy>
- Upstream package source used for oracle generation: `packages/json-joy`

Fixtures are generated by:

- `tools/oracle-node/generate-fixtures.cjs`

Pinned upstream baseline:

- `json-joy@17.67.0`

Regenerate fixtures from repo root:

```bash
bin/generate-compat-fixtures.sh
```

## Parity harness

Integration tests:

- `crates/json-joy/tests/compat_inventory.rs`
- `crates/json-joy/tests/compat_fixtures.rs`

Run:

```bash
just parity-fixtures
```

Default repository gates also include fixture parity:

```bash
just test-gates
```

The inventory test enforces the pinned fixture contract including:

- `fixture_version = 1`
- `upstream_package = "json-joy"`
- `upstream_version = "17.67.0"`
- `fixture_count = 1398`
- exact per-scenario counts

## XFail policy

Known divergences are tracked in:

- `tests/compat/xfail.toml`
- `tests/compat/PARITY_AUDIT.md`

Each entry defines:

- `scenario`
- `name`
- `reason`
- `source_file`
- `issue`

Harness rules:

- failing fixture not in xfail => test failure
- failing fixture in xfail => allowed
- xfail entry that now passes exactly (non-wildcard) => unexpected pass failure
- xfail entry that matches no current fixture => stale xfail failure

## Live differential check

Live TS<->WASM core differential checks are manual-only:

```bash
just parity-live
```
